# cookie

**Привязываются к доменному имени / URL-адресу
Также возможно доп настройка деректив -** `Domain` и `Path` 

```jsx
// Примерный вид 
'vblastvisit=1618405236; vblastactivity=0; __utmc=216415245;'
```

Куки – это небольшие строки данных, которые хранятся в браузере. Являются частью HTTP-протокола.

Куки обычно устанавливаются веб-сервером при помощи заголовка `Set-Cookie`. Затем браузер будет автоматически добавлять их в (почти) каждый запрос на тот же домен при помощи заголовка `Cookie`.

Обычно используются для:

- Управления сессией (логины, корзины для виртуальных покупок)
- Персонализации (пользовательские предпочтения)
- Трекинга (отслеживания поведения пользователей)

Один из наиболее частых случаев использования куки – это аутентификация:

1. При входе на сайт сервер отсылает в ответ HTTP-заголовок `Set-Cookie`,  установливая  куки со специальным  идентификатором сессии («session identifier»).
2. Во время следующего запроса к этому же домену браузер посылает на сервер HTTP-заголовок `Cookie`.

Ограничения:

- одна пара куки должна занимать не более 4Кб.
- общее количество куки на один домен ограничивается примерно 20 - 1000 в зависимости от браузера.

### Работа с cookie производится через свойства аксессоры:

- **чтение** 
возможно потребуется декодирование спец. символов

```
log( decodeURIComponent(document.cookie) ); // 'cookie1=value1; cookie2=value2;'
```

- **запись**:

При записи необходимо кодирование спец. символов, через встроенную функцию `encodeURIComponent`:

```jsx
// специальные символы (пробелы), требуется кодирование
let name = "my name";   let value = "John Smith"

// кодирует в my%20name=John%20Smith
document.cookie = encodeURIComponent(name) + '=' + encodeURIComponent(value);

log(document.cookie); // ...; my%20name=John%20Smith
```

### Возможные настройки:

```jsx
document.cookie = "user=John; path=/; domain=site.com; expires=Tue, 19 Jan 2038 03:14:07 GMT"
```

- **domain** 
Указывает хосты, на которые отсылаются куки. Если он не задан, то по умолчанию берётся доменная часть адреса документа (но без поддоменов). Если домен указан явно, то поддомены всегда включены
Например, если задано `Domain=mozilla.org`, то куки включены и в поддоменах, например, в `developer.mozilla.org`.

- **path** - обычно указывают корень -  `path=/`
Указывает URL, который должен быть в запрашиваемом ресурсе на момент отправки заголовка `Cookie`.

Например - куки установлено с `path=/admin`, то оно будет доступно на страницах `/admin` и `/admin/something`, но не на страницах `/home` или `/adminpage`.

- **expires / max-ege - время жизни *cookie***
Если эти параметры не задаются, то  ***cookie являются -* ”сессионными”** - удалятся при закрытии браузера / сессии.
***Постоянные cookie* (*permanent cookies*)** удаляются не с закрытием клиента, а при наступлении определённой даты указанной в атрибутах expires или max-age

max-age -  значение в секундах с момента установки
expires - дата истечения срока действия в формате “date.toUTCString”
***Если дата прошедшая или значение ≤0, то куки удаляются***

- **secure ( безопасные )**
Отсылаются на сервер только по протоколам SSL и HTTPS
- **httpOnly ( без доступа JS )**
К ним нет доступа через JavaScript и свойство Document.cookie, что помогает избежать межсайтового скриптинга XSS

- **sameSite**
C помощью атрибута `SameSite` можно указать, когда и как отправлять куки с межсайтовыми запросами (где сайт определяется комбинацией домена и схемы `http:` или `https:`). В некоторой степени этот атрибут защищает от межсайтовой подделки запроса CSRF. `SameSite` может принимать три возможных значения: `Strict`, `Lax` и `None`.

`Strict` - куки будут отправляться только тому сайту, которому эти куки принадлежат.

`Lax` - как и`Strict` , но куки будут отправляться также при навигации на тот сайт, которому принадлежат куки. Например, при переходе по ссылке с внешнего сайта. 

`None` отключает ограничение на отправку кук для межсайтовых запросов, но только в безопасном контексте (то есть если установлен `SameSite=None`, тогда также должен быть установлен атрибут `Secure`).

Если атрибут `SameSite` не установлен, куки будут восприниматься как `Lax`.